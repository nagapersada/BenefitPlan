<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DVTEAM NP - Benefit Plan</title>
    
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/BenefitPlan/manifest.json">
    <link rel="apple-touch-icon" href="/BenefitPlan/images/apple-touch-icon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* General Body Style */
        body { font-family: 'Inter', sans-serif; background-color: #020617; background-image: radial-gradient(ellipse at top, #1e293b, #020617); color: #cbd5e1; overflow: hidden; }
        
        /* Splash Screen (Slide 1) Styles */
        #splash-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; padding: 1.5rem; text-align: center; animation: fadeIn 1s ease-out forwards; position: fixed; top: 0; left: 0; width: 100%; z-index: 100; }
        .splash-logo { max-width: 300px; width: 100%; height: auto; margin-bottom: 1.5rem; }
        .splash-title { font-size: 2rem; font-weight: 800; color: #f0f9ff; letter-spacing: -0.025em; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); }
        .splash-subtitle { font-size: 1rem; color: #94a3b8; margin-top: 0.5rem; max-width: 400px; }
        .enter-button { margin-top: 2.5rem; background: linear-gradient(to right, #eab308, #f59e0b); color: #1e293b; padding: 0.75rem 2rem; font-weight: 700; border-radius: 0.5rem; box-shadow: 0 4px 20px -1px rgb(234 179 8 / 0.4); transition: all 0.3s ease; }
        .enter-button:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 7px 25px -1px rgb(234 179 8 / 0.5); }
        
        /* Dashboard (Slide 2) Styles */
        #dashboard-content { display: none; /* Awalnya disembunyikan */ height: 100vh; overflow-y: auto; }

        /* Styles from new BenefitPlan.html */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes pulse-update { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        /* CSS untuk teks kedap-kedip */
        @keyframes blink {
            0%, 100% { opacity: 1; text-shadow: 0 0 15px #fcd34d, 0 0 5px #fef3c7; }
            50% { opacity: 0.2; text-shadow: none; }
        }
        .juara-text {
            animation: blink 0.8s infinite alternate;
        }
        .card { background-color: rgba(30, 41, 59, 0.6); border-radius: 0.75rem; border: 1px solid; border-image-source: linear-gradient(to bottom right, #334155, rgba(51, 65, 85, 0)); border-image-slice: 1; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .action-button { background: linear-gradient(to right, #0ea5e9, #22d3ee); box-shadow: 0 4px 20px -1px rgb(14 165 233 / 0.3); }
        .action-button:hover { transform: translateY(-2px); box-shadow: 0 7px 25px -1px rgb(14 165 233 / 0.4); }
        .back-button { background-color: #1e293b; color: #94a3b8; border: 1px solid #334155; }
        .back-button:hover { background-color: #334155; }
        .tab-button-wrapper { background-color: #1e293b; padding: 0.25rem; border-radius: 0.5rem; }
        .tab-button { transition: all 0.2s ease-in-out; border-radius: 0.375rem; color: #94a3b8; }
        .tab-button.active { background-color: #334155; color: #f1f5f9; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
        .number-pulse { animation: pulse-update 0.4s ease-out; }
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; pointer-events: none; display: none; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="/BenefitPlan/images/logo-splash.png" alt="DVTEAM NP Logo" class="splash-logo">
        <h1 class="splash-title">Raih Potensi Puncak Anda</h1>
        <p class="splash-subtitle">Selamat datang di Simulator Benefit Plan. Alat bantu eksklusif untuk merancang masa depan dan kesuksesan tim Anda.</p>
        <button id="enter-button" class="enter-button">MASUK SIMULATOR</button>
    </div>

    <div id="dashboard-content">
        <canvas id="confetti-canvas"></canvas>
        <div class="container mx-auto p-4 md:p-6 max-w-6xl relative z-10">
            <header class="text-center mb-8">
                <div class="flex justify-center items-center">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white tracking-tight">Dashboard Proyeksi Benefit Plan</h1>
                    <button id="play-audio-button" title="Putar Panduan Audio" class="ml-3 text-slate-400 hover:text-cyan-400 transition-colors duration-300 p-2">
                        <svg id="speaker-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                        <svg id="speaker-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l-5-5m0 5l5-5" /></svg>
                    </button>
                </div>
                <p class="text-slate-400 mt-3 max-w-xl mx-auto text-sm">Alat bantu visual untuk merencanakan strategi dan memaksimalkan potensi pertumbuhan tim Anda.</p>
            </header>
    
            <div class="grid grid-cols-1 gap-4">
                <div class="space-y-4">
                     <div class="card p-4">
                        <div class="space-y-2 px-2">
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-slate-400">Bonus Reveral Lv.1 (5%)</span>
                                <span class="font-semibold text-emerald-400" id="resBonusReveral1"></span>
                            </div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-slate-400">Bonus Reveral Lv.2 (2%)</span>
                                <span class="font-semibold text-emerald-400" id="resBonusReveral2"></span>
                            </div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-slate-400">Bonus Tim</span>
                                <span class="font-semibold text-emerald-400" id="resBonusTim"></span>
                            </div>
                        </div>
                    </div>
    
                    <div class="card p-5 pb-40 sticky top-6">
                        <div class="flex items-center justify-between mb-5">
                            <div class="space-y-2"> 
                                <div class="flex flex-col justify-center">
                                    <div class="text-center">
                                        <div class="flex items-center justify-center space-x-2">
                                            <div id="anda-label" class="bg-blue-200 text-blue-800 font-bold text-xs px-3 py-1 rounded-full transition-colors duration-300">ANDA</div>
                                            <div id="crown-icon" class="hidden">
                                                <span class="text-base">ðŸ‘‘</span>
                                            </div>
                                        </div>
                                        <div id="ketua-tim-label" class="mt-1 h-4"></div>
                                    </div>
                                    </div>
                                <div>
                                    <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Status & Peringkat</p>
                                    <div class="flex items-center space-x-2 mt-1 whitespace-nowrap">
                                        <div id="kpiStatus"></div>
                                        <div id="kpiBonusPeringkat" class="font-bold text-emerald-400 text-lg"></div> 
                                    </div>
                                    </div>
                                 <div>
                                     <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Batasan Modal</p>
                                     <p class="font-bold text-white text-base" id="resBatasanModal"></p>
                                 </div>
                                 <div class="pt-1"> 
                                     <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Total Anggota</p>
                                     <p class="font-bold text-white text-base" id="resTotalAnggotaPanel"></p>
                                 </div>
                                 <div class="space-y-1 pt-2" id="sinyalContainer">
                                     <div id="resSinyalSSM"></div>
                                     <div id="resSinyal3Panel"></div>
                                     <div id="resSinyal4Panel"></div>
                                 </div>
                                 </div>
                            <div class="text-right space-y-2"> 
                                <div id="resSinyalSSM_OLD" class="hidden"></div>
                                 <div>
                                     <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Total Bonus</p>
                                     <p class="text-xl font-extrabold text-cyan-400" id="kpiTotalBonus"></p>
                                 </div>
                                 <div>
                                     <p class="text-slate-400 text-xs">Saldo Akun</p>
                                     <p class="font-bold text-white text-base" id="resModalAwalPanel"></p>
                                 </div>
                                 <div>
                                     <p class="text-slate-400 text-xs">Bonus Volume</p>
                                     <p class="font-bold text-cyan-400 text-base" id="resBonusVolume"></p>
                                 </div>
                                 <div id="resSinyal3Panel_OLD" class="hidden"></div>
                            </div>
                        </div>
                        <div class="space-y-4 pt-5 border-t border-slate-700" id="controls-body">
                             </div>
                        
                        <div id="fokus-message" class="mt-8 text-center">
                            <p class="text-sm font-bold uppercase text-amber-400 tracking-wider">Fokus Kepada 5 Anggota</p>
                        </div>
    
                        <div id="juara-message-container" class="mt-8 text-center hidden">
                            <h3 class="juara-text text-2xl md:text-3xl font-extrabold text-amber-400 tracking-wider">SELAMAT ANDA JUARA..!!</h3>
                        </div>
    
                    </div>
                </div>
    
                </div>
        </div>
    </div>
    
    <audio id="tutorial-audio" src="benefit(2).mp3" preload="auto"></audio>

    <script>
        // --- PWA, UI Control, & Audio Player Script ---
        document.addEventListener('DOMContentLoaded', () => {
            const enterButton = document.getElementById('enter-button');
            const splashScreen = document.getElementById('splash-screen');
            const dashboardContent = document.getElementById('dashboard-content');
            
            enterButton.addEventListener('click', () => {
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(err => { console.log(`Error: ${err.message}`); });
                } else if (elem.webkitRequestFullscreen) { /* Safari */
                    elem.webkitRequestFullscreen();
                }

                splashScreen.style.animation = 'fadeOut 0.5s ease-in forwards';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    dashboardContent.style.display = 'block';
                    dashboardContent.style.animation = 'fadeIn 0.5s ease-out forwards';
                    document.body.style.overflow = 'auto';
                    
                    initializeSimulator();
                }, 500);
            });
            
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/BenefitPlan/sw.js').then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }, err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
                });
            }

            const audioButton = document.getElementById('play-audio-button');
            const audio = document.getElementById('tutorial-audio');
            const speakerIcon = document.getElementById('speaker-icon');
            const speakerOffIcon = document.getElementById('speaker-off-icon');

            audioButton.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                } else {
                    audio.pause();
                }
            });

            audio.onplay = () => {
                speakerIcon.classList.add('hidden');
                speakerOffIcon.classList.remove('hidden');
            };

            audio.onpause = () => {
                speakerIcon.classList.remove('hidden');
                speakerOffIcon.classList.add('hidden');
            };
        });

        // --- SIMULATOR SCRIPT ---
        let anggotaLevels = [0, 0, 0, 0, 0];
        let simulationMode = 'recruit_lv1'; 
        let confettiInterval;
        let animationFrameId;
        let memberState = {};

        function resetMemberState() {
             memberState = {
                A: { isLeader: false, duplicationLevels: 0 },
                B: { isLeader: false, duplicationLevels: 0 },
                C: { isLeader: false, duplicationLevels: 0 },
                D: { isLeader: false, duplicationLevels: 0 },
                E: { isLeader: false, duplicationLevels: 0 },
            };
        }

        function initializeSimulator() {
            resetMemberState();
            renderControls();
        }

        function switchTab(tabName) {
            console.log(`Tab switch requested to ${tabName}, but tab UI is removed.`);
        }

        function activateDuplicationMode() {
            simulationMode = 'duplicating_lv1';
            resetMemberState();
            renderControls(); 
        }
        
        function growTeam() {
            const activeLeaders = Object.entries(memberState).filter(([_, member]) => member.isLeader);
            if (activeLeaders.length === 0) return;

            let lowestLevel = 5;
            activeLeaders.forEach(([_, member]) => {
                lowestLevel = Math.min(lowestLevel, member.duplicationLevels);
            });

            if (lowestLevel >= 4) return;

            for (const [letter, member] of Object.entries(memberState)) {
                if (member.isLeader && member.duplicationLevels === lowestLevel) {
                    member.duplicationLevels++;
                    break;
                }
            }
            
            updateSimulation();
        }

        function goBack() {
            const activeLeaders = Object.entries(memberState).filter(([_, member]) => member.isLeader);
            let highestLevel = 0;
            activeLeaders.forEach(([_, member]) => {
                highestLevel = Math.max(highestLevel, member.duplicationLevels);
            });

            if (highestLevel <= 1) {
                 simulationMode = 'recruit_lv1';
                 resetMemberState();
                 renderControls();
                 setTimeout(() => {
                    ['A', 'B', 'C', 'D', 'E'].forEach(l => { 
                        const cb = document.getElementById(`member${l}`);
                        if(cb) cb.checked = true; 
                    });
                    handleCheckboxChange();
                 }, 0);
            } else {
                const members = ['E', 'D', 'C', 'B', 'A'];
                for (const letter of members) {
                    const member = memberState[letter];
                    if (member.isLeader && member.duplicationLevels === highestLevel) {
                        member.duplicationLevels--;
                        break;
                    }
                }
                updateSimulation();
            }
        }

        function handleCheckboxChange() {
            if (simulationMode === 'recruit_lv1') {
                let count = document.querySelectorAll('#controls-body input[type="checkbox"]:checked').length;
                anggotaLevels[0] = count;
            } else if (simulationMode === 'duplicating_lv1') {
                ['A', 'B', 'C', 'D', 'E'].forEach(letter => {
                    const checkbox = document.getElementById(`member${letter}`);
                    if (checkbox.checked) {
                        if (!memberState[letter].isLeader) {
                            memberState[letter].isLeader = true;
                            memberState[letter].duplicationLevels = 1;
                        }
                    } else {
                        memberState[letter].isLeader = false;
                        memberState[letter].duplicationLevels = 0;
                    }
                });
            }
            updateSimulation();
        }

        function renderControls() {
            const container = document.getElementById('controls-body');
            const members = ['A', 'B', 'C', 'D', 'E'];
            let labelText = "Membangun Anggota Tim"; 
            let checkboxBaseStyle = "bg-slate-800 border-slate-700 text-slate-300";
            let checkboxCheckedStyle = "peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:border-indigo-500";
            
            if (simulationMode === 'duplicating_lv1') {
                labelText = "Membangun ketua tim";
                checkboxBaseStyle = "bg-indigo-900/50 border-indigo-700 text-indigo-300";
                checkboxCheckedStyle = "peer-checked:bg-amber-400 peer-checked:text-white peer-checked:border-amber-400";
            }

            let checkboxHTML = members.map(letter => `
                <div>
                    <div id="kt-label-${letter}" class="text-center h-4 mb-2"></div>
                    <input type="checkbox" id="member${letter}" class="hidden peer">
                    <label for="member${letter}" class="block cursor-pointer p-2 text-center rounded-lg border ${checkboxBaseStyle} ${checkboxCheckedStyle} font-bold transition text-sm">${letter}</label>
                    <div class="mt-1 space-y-1 flex flex-col items-center">
                         <div id="duplication-tree-${letter}" class="flex flex-col items-center space-y-1"></div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <label class="block font-medium text-slate-400 text-sm">${labelText}</label>
                    <div id="action-icons-container" class="flex items-center space-x-2 h-8"></div>
                </div>
                <div class="grid grid-cols-5 gap-1.5">
                    ${checkboxHTML}
                </div>
            `;
            members.forEach(letter => {
                document.getElementById(`member${letter}`).onchange = handleCheckboxChange;
            });

            updateSimulation();
        }

        function renderDuplicationTree() {
            Object.entries(memberState).forEach(([letter, member]) => {
                const treeContainer = document.getElementById(`duplication-tree-${letter}`);
                if (treeContainer) {
                    treeContainer.innerHTML = ''; 
                    if (member.isLeader) {
                        for (let i = 1; i <= member.duplicationLevels; i++) {
                            const numberValue = 5 ** i;
                            const numberDiv = document.createElement('div');
                            numberDiv.className = "text-xs font-bold text-slate-400 bg-slate-700 px-2 py-0.5 rounded-md";
                            numberDiv.textContent = numberValue.toLocaleString('id-ID');
                            treeContainer.appendChild(numberDiv);
                        }
                    }
                }
            });
        }
        
        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        let confettiPieces = [];
        const confettiColors = ['#fde68a', '#facc15', '#eab308', '#d97706'];
        function startConfetti() {
            if (confettiInterval) return;
            confettiCanvas.style.display = 'block';
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
            confettiInterval = setInterval(() => { for (let i = 0; i < 20; i++) { createConfetti(); } }, 500);
            animateConfetti();
        }
        function stopConfetti() {
            if (!confettiInterval) return;
            clearInterval(confettiInterval);
            confettiInterval = null;
            cancelAnimationFrame(animationFrameId);
            setTimeout(() => { if (confettiCanvas) { confettiCanvas.style.display = 'none'; confettiPieces = []; } }, 3000);
        }
        function createConfetti() { confettiPieces.push({ x: Math.random() * confettiCanvas.width, y: -20, w: 5 + Math.random() * 10, h: 10 + Math.random() * 10, color: confettiColors[Math.floor(Math.random() * confettiColors.length)], rotation: Math.random() * 360, speedX: Math.random() * 4 - 2, speedY: 2 + Math.random() * 3, opacity: 1 }); }
        function animateConfetti() {
            animationFrameId = requestAnimationFrame(animateConfetti);
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            confettiPieces.forEach((piece, index) => {
                piece.y += piece.speedY; piece.x += piece.speedX; piece.rotation += piece.speedX; piece.opacity -= 0.005;
                if (piece.y > confettiCanvas.height || piece.opacity <= 0) { confettiPieces.splice(index, 1); }
                confettiCtx.save(); confettiCtx.translate(piece.x, piece.y); confettiCtx.rotate(piece.rotation * Math.PI / 180); confettiCtx.globalAlpha = piece.opacity; confettiCtx.fillStyle = piece.color; confettiCtx.fillRect(-piece.w / 2, -piece.h / 2, piece.w, piece.h); confettiCtx.restore();
            });
        }

        function updateSimulation() {
            if (simulationMode === 'duplicating_lv1') {
                anggotaLevels = [5, 0, 0, 0, 0];
                Object.values(memberState).forEach(member => {
                    if (member.isLeader) {
                        if (member.duplicationLevels >= 1) anggotaLevels[1] += 5;
                        if (member.duplicationLevels >= 2) anggotaLevels[2] += 25;
                        if (member.duplicationLevels >= 3) anggotaLevels[3] += 125;
                        if (member.duplicationLevels >= 4) anggotaLevels[4] += 625;
                    }
                });
            } else {
                 anggotaLevels.fill(0, 1);
            }

            const totalAnggotaTim = anggotaLevels.reduce((a, b) => a + b, 0);
            const totalAnggota = totalAnggotaTim + 1;

            const depositAwal = 100;
            const bonusReveralLv1 = anggotaLevels[0] * (0.05 * 100);
            const bonusReveralLv2 = anggotaLevels[1] * (0.02 * 100);
            const bonusTim = anggotaLevels[0] >= 5 ? 20 : 0;
            let cumulativeBonusPeringkat = 0;
            if (anggotaLevels[0] >= 5) { cumulativeBonusPeringkat += 50; }
            if (totalAnggota >= 31) { cumulativeBonusPeringkat += 100; }
            if (totalAnggota >= 101) { cumulativeBonusPeringkat += 200; }
            if (totalAnggota >= 201) { cumulativeBonusPeringkat += 400; }
            if (totalAnggota >= 351) { cumulativeBonusPeringkat += 600; }
            if (totalAnggota >= 501) { cumulativeBonusPeringkat += 1000; }
            if (totalAnggota >= 901) { cumulativeBonusPeringkat += 2000; }
            if (totalAnggota >= 1601) { cumulativeBonusPeringkat += 3000; }
            if (totalAnggota >= 3501) { cumulativeBonusPeringkat += 5000; }

            let status = "Anggota", statusColor = "bg-yellow-400/20 text-yellow-300", bonusPeringkatForDisplay = 0;
            if (totalAnggota >= 3501) { status = "VIP 9"; statusColor = "bg-violet-400/20 text-violet-300"; bonusPeringkatForDisplay = 5000;}
            else if (totalAnggota >= 1601) { status = "VIP 8"; statusColor = "bg-violet-400/20 text-violet-300"; bonusPeringkatForDisplay = 3000;}
            else if (totalAnggota >= 901) { status = "VIP 7"; statusColor = "bg-indigo-400/20 text-indigo-300"; bonusPeringkatForDisplay = 2000;}
            else if (totalAnggota >= 501) { status = "VIP 6"; statusColor = "bg-indigo-400/20 text-indigo-300"; bonusPeringkatForDisplay = 1000;}
            else if (totalAnggota >= 351) { status = "VIP 5"; statusColor = "bg-blue-400/20 text-blue-300"; bonusPeringkatForDisplay = 600;}
            else if (totalAnggota >= 201) { status = "VIP 4"; statusColor = "bg-blue-400/20 text-blue-300"; bonusPeringkatForDisplay = 400;}
            else if (totalAnggota >= 101) { status = "VIP 3"; statusColor = "bg-cyan-400/20 text-cyan-300"; bonusPeringkatForDisplay = 200;}
            else if (totalAnggota >= 31) { status = "VIP 2"; statusColor = "bg-cyan-400/20 text-cyan-300"; bonusPeringkatForDisplay = 100;}
            else if (anggotaLevels[0] >= 5) { status = "VIP 1"; statusColor = "bg-emerald-400/20 text-emerald-300"; bonusPeringkatForDisplay = 50;}
            const totalBonus = bonusReveralLv1 + bonusReveralLv2 + bonusTim + cumulativeBonusPeringkat;
            const saldoAkun = depositAwal + totalBonus;
            const leadersInLv1 = Math.floor(anggotaLevels[1] / 5);
            let batasanModal;
            if (anggotaLevels[0] < 5) { batasanModal = 300 + (anggotaLevels[0] * 30); } else { let currentLimit = 450; if (simulationMode === 'duplicating_lv1' || anggotaLevels[1] > 0) { if (anggotaLevels[1] === 25) { currentLimit = 450 + 2700; if (anggotaLevels[2] === 125) { currentLimit = 450 + (2700 * 5); if (anggotaLevels[3] === 625) { currentLimit = 450 + (13950 * 5); if (anggotaLevels[4] === 3125) { currentLimit = 450 + (69750 * 5); } } } } else { currentLimit = 450 + (leadersInLv1 * 450); } } batasanModal = currentLimit; }
            let sinyalKe3 = "Tidak Aktif"; if (anggotaLevels[0] >= 5) { if (leadersInLv1 === 5) sinyalKe3 = "Permanen"; else if (leadersInLv1 === 4) sinyalKe3 = "25 Hari"; else if (leadersInLv1 === 3) sinyalKe3 = "20 Hari"; else if (leadersInLv1 === 2) sinyalKe3 = "15 Hari"; else if (leadersInLv1 === 1) sinyalKe3 = "10 Hari"; else sinyalKe3 = "5 Hari"; }
            let sinyalKe4 = "Belum Aktif"; if (anggotaLevels[1] > 0) { sinyalKe4 = "10 Hari"; }
            let bonusVolume = "0%"; if (anggotaLevels[0] >= 5) { if (totalAnggota >= 3501) { bonusVolume = "5%"; } else if (totalAnggota >= 1601) { bonusVolume = "3.5%"; } else if (totalAnggota >= 901) { bonusVolume = "3%"; } else if (totalAnggota >= 501) { bonusVolume = "2.5%"; } else if (totalAnggota >= 351) { bonusVolume = "2%"; } else if (totalAnggota >= 201) { bonusVolume = "1.5%"; } else if (totalAnggota >= 101) { bonusVolume = "1%"; } else if (totalAnggota >= 31) { bonusVolume = "0.5%"; } else if (totalAnggota >= 5) { bonusVolume = "0.3%"; } }
            
            const isVip9 = status === "VIP 9";
            const juaraMessageContainer = document.getElementById('juara-message-container');
            const fokusMessage = document.getElementById('fokus-message');

            if (isVip9) { 
                startConfetti(); 
                if(juaraMessageContainer) juaraMessageContainer.classList.remove('hidden');
                if(fokusMessage) fokusMessage.classList.add('hidden');
            } else { 
                stopConfetti(); 
                if(juaraMessageContainer) juaraMessageContainer.classList.add('hidden');
                if(fokusMessage) fokusMessage.classList.remove('hidden');
            }

            const andaLabel = document.getElementById('anda-label');
            const ketuaTimLabel = document.getElementById('ketua-tim-label');
            const crownIcon = document.getElementById('crown-icon');
            if (anggotaLevels[0] === 5) { andaLabel.classList.remove('bg-indigo-100', 'text-indigo-800', 'bg-blue-200', 'text-blue-800'); andaLabel.classList.add('bg-amber-400/20', 'text-amber-300'); ketuaTimLabel.innerHTML = `<span class="text-xs font-bold text-emerald-400">Ketua Tim</span>`; if(crownIcon) crownIcon.classList.remove('hidden'); } else { andaLabel.classList.remove('bg-amber-400/20', 'text-amber-300'); andaLabel.classList.add('bg-indigo-100', 'text-indigo-800'); ketuaTimLabel.innerHTML = ''; if(crownIcon) crownIcon.classList.add('hidden'); }
             if (simulationMode === 'duplicating_lv1') { Object.entries(memberState).forEach(([letter, member]) => { const ktLabel = document.getElementById(`kt-label-${letter}`); document.getElementById(`member${letter}`).checked = member.isLeader; if(member.isLeader) { ktLabel.innerHTML = `<span class="text-base">ðŸ‘‘</span>`; } else { ktLabel.innerHTML = ''; } }); }
            const actionIconsContainer = document.getElementById('action-icons-container');
            if(actionIconsContainer) actionIconsContainer.innerHTML = '';
            if (simulationMode === 'recruit_lv1' && anggotaLevels[0] === 5) { if(actionIconsContainer) { actionIconsContainer.innerHTML = `<button title="Duplikasikan Tim" class="action-button p-2 rounded-full transition transform hover:scale-110" onclick="activateDuplicationMode()"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h6a2 2 0 00-2-2H5z" /></svg></button>`; }
            } else if (simulationMode === 'duplicating_lv1') {
                const activeLeaders = Object.values(memberState).filter(m => m.isLeader);
                const hasLeaders = activeLeaders.length > 0;
                let showDuplicateButton = false;
                if (hasLeaders) {
                    const allAtMax = activeLeaders.every(m => m.duplicationLevels === 4);
                    if (!allAtMax) {
                        showDuplicateButton = true;
                    }
                }

                let iconsHTML = `<button title="Kembali" class="back-button p-2 rounded-full transition transform hover:scale-110" onclick="goBack()"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg></button>`;
                if (showDuplicateButton) { 
                    iconsHTML += `<button title="Duplikasikan" class="action-button p-2 rounded-full transition transform hover:scale-110" onclick="growTeam()"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h6a2 2 0 00-2-2H5z" /></svg></button>`; 
                }
                if(actionIconsContainer) actionIconsContainer.innerHTML = iconsHTML;
            }
            renderDuplicationTree();
            document.getElementById('kpiTotalBonus').textContent = `+${totalBonus.toLocaleString('id-ID')} USDT`;
            document.getElementById('kpiStatus').innerHTML = `<span class="px-2 py-1 rounded-full font-bold text-xs ${statusColor}">${status}</span>`;
            document.getElementById('kpiBonusPeringkat').textContent = bonusPeringkatForDisplay > 0 ? `+${bonusPeringkatForDisplay.toLocaleString('id-ID')} USDT` : '';
            document.getElementById('resBonusVolume').textContent = bonusVolume;
            document.getElementById('resModalAwalPanel').textContent = `${saldoAkun.toLocaleString('id-ID')} USDT`;
            document.getElementById('resBonusReveral1').textContent = `+ ${bonusReveralLv1.toLocaleString('id-ID')} USDT`;
            document.getElementById('resBonusReveral2').textContent = `+ ${bonusReveralLv2.toLocaleString('id-ID')} USDT`;
            document.getElementById('resBonusTim').textContent = `+ ${bonusTim.toLocaleString('id-ID')} USDT`;
            document.getElementById('resBatasanModal').textContent = `${batasanModal.toLocaleString('id-ID')} USDT`;
            document.getElementById('resTotalAnggotaPanel').textContent = `${totalAnggotaTim.toLocaleString('id-ID')} Anggota`; 

            const check = `<svg class="inline-block h-4 w-4 mr-1 text-emerald-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`;
            const cross = `<svg class="inline-block h-4 w-4 mr-1 text-slate-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>`;
            
            const sinyalSSM = `<div class="text-xs text-emerald-400 font-semibold flex items-center pt-1 whitespace-nowrap"><span class="flex items-center">${check}<span>Sinyal Siang & Malam</span></span></div>`;

            const sinyal3 = `
                <div class="text-xs ${sinyalKe3 !== 'Tidak Aktif' ? 'text-emerald-400' : 'text-slate-500'} font-semibold flex items-center pt-1 whitespace-nowrap">
                    <span class="flex items-center">
                        ${sinyalKe3 !== 'Tidak Aktif' ? check : cross}
                        <span>Sinyal ke-3: ${sinyalKe3}</span>
                    </span>
                </div>
            `;

            const sinyal4 = `
                <div class="text-xs ${sinyalKe4 !== 'Belum Aktif' ? 'text-emerald-400' : 'text-slate-500'} font-semibold flex items-center pt-1 whitespace-nowrap">
                    <span class="flex items-center">
                        ${sinyalKe4 !== 'Belum Aktif' ? check : cross}
                        <span>Sinyal ke-4: ${sinyalKe4}</span>
                    </span>
                </div>
            `;
            
            const sinyalContainer = document.getElementById('sinyalContainer');
            if (sinyalContainer) sinyalContainer.innerHTML = sinyalSSM + sinyal3 + sinyal4;

            const oldSsm = document.getElementById('resSinyalSSM_OLD');
            if (oldSsm) oldSsm.innerHTML = '';
            const oldS3 = document.getElementById('resSinyal3Panel_OLD');
            if(oldS3) oldS3.innerHTML = '';

            function pulseElement(elementId) { const element = document.getElementById(elementId); if (element) { element.classList.add('number-pulse'); setTimeout(() => { element.classList.remove('number-pulse'); }, 400); } }
            pulseElement('kpiTotalBonus');
            pulseElement('resModalAwalPanel');
        }
    </script>
</body>
</html>
